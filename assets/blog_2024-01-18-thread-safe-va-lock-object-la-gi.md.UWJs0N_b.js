import{_ as i,j as n,o as s,v as a}from"./chunks/framework.OuVixYWh.js";const h=JSON.parse('{"title":"Thread safe, Lock object lÃ  gÃ¬ ?","description":"Thread safety vÃ  lock objects lÃ  cÃ¡c thÃ nh pháº§n quan trá»ng cá»§a láº­p trÃ¬nh Ä‘a luá»“ng vÃ  giÃºp cÃ¡c á»©ng dá»¥ng hoáº¡t Ä‘á»™ng má»™t cÃ¡ch á»•n Ä‘á»‹nh vÃ  an toÃ n hÆ¡n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.","frontmatter":{"footer":true,"title":"Thread safe, Lock object lÃ  gÃ¬ ?","description":"Thread safety vÃ  lock objects lÃ  cÃ¡c thÃ nh pháº§n quan trá»ng cá»§a láº­p trÃ¬nh Ä‘a luá»“ng vÃ  giÃºp cÃ¡c á»©ng dá»¥ng hoáº¡t Ä‘á»™ng má»™t cÃ¡ch á»•n Ä‘á»‹nh vÃ  an toÃ n hÆ¡n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.","authors":["lethanh"],"date":"2024-01-18T00:00:00.000Z","image":"https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img.png","outline":"deep"},"headers":[{"level":2,"title":"Thread safe lÃ  gÃ¬ ?","slug":"thread-safe-la-gi","link":"#thread-safe-la-gi","children":[{"level":3,"title":"VÃ­ dá»¥","slug":"vi-du","link":"#vi-du","children":[]},{"level":3,"title":"code demo khÃ´ng Thread Safety","slug":"code-demo-khong-thread-safety","link":"#code-demo-khong-thread-safety","children":[]}]},{"level":2,"title":"Lock object lÃ  gÃ¬ ?","slug":"lock-object-la-gi","link":"#lock-object-la-gi","children":[]},{"level":2,"title":"CÃ¡c háº¡n cháº¿ cá»§a Lock object","slug":"cac-han-che-cua-lock-object","link":"#cac-han-che-cua-lock-object","children":[{"level":3,"title":"Thá»i gian chá» Ä‘á»£i (Latency):","slug":"thoi-gian-cho-Ä‘oi-latency","link":"#thoi-gian-cho-Ä‘oi-latency","children":[]},{"level":3,"title":"Deadlocks:","slug":"deadlocks","link":"#deadlocks","children":[]},{"level":3,"title":"Thá»­ tá»± má»›i (Priority Inversion):","slug":"thu-tu-moi-priority-inversion","link":"#thu-tu-moi-priority-inversion","children":[]},{"level":3,"title":"Scalability:","slug":"scalability","link":"#scalability","children":[]}]},{"level":2,"title":"CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a Lock object trong java","slug":"cach-thuc-hoat-Ä‘ong-cua-lock-object-trong-java","link":"#cach-thuc-hoat-Ä‘ong-cua-lock-object-trong-java","children":[{"level":3,"title":"Set of threads waiting to acquire lock (Táº­p há»£p cÃ¡c thread chá» chiáº¿m tÃ i nguyÃªn)","slug":"set-of-threads-waiting-to-acquire-lock-tap-hop-cac-thread-cho-chiem-tai-nguyen","link":"#set-of-threads-waiting-to-acquire-lock-tap-hop-cac-thread-cho-chiem-tai-nguyen","children":[]},{"level":3,"title":"Acquire (Chiáº¿m láº¥y)","slug":"acquire-chiem-lay","link":"#acquire-chiem-lay","children":[]},{"level":3,"title":"Object","slug":"object","link":"#object","children":[]},{"level":3,"title":"Monitor","slug":"monitor","link":"#monitor","children":[]},{"level":3,"title":"Owning thread","slug":"owning-thread","link":"#owning-thread","children":[]},{"level":3,"title":"Release the monitor (Giáº£i phÃ³ng monitor)","slug":"release-the-monitor-giai-phong-monitor","link":"#release-the-monitor-giai-phong-monitor","children":[]},{"level":3,"title":"Set of waiting threads waiting to reacquire lock (Táº­p há»£p cÃ¡c thread Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m láº¥y lock)","slug":"set-of-waiting-threads-waiting-to-reacquire-lock-tap-hop-cac-thread-Ä‘ang-cho-Ä‘e-tai-chiem-lay-lock","link":"#set-of-waiting-threads-waiting-to-reacquire-lock-tap-hop-cac-thread-Ä‘ang-cho-Ä‘e-tai-chiem-lay-lock","children":[]}]},{"level":2,"title":"VÃ­ dá»¥:","slug":"vi-du-1","link":"#vi-du-1","children":[]},{"level":2,"title":"VÃ­ dá»¥ code:","slug":"vi-du-code","link":"#vi-du-code","children":[]},{"level":2,"title":"Tá»•ng káº¿t","slug":"tong-ket","link":"#tong-ket","children":[]}],"relativePath":"blog/2024-01-18-thread-safe-va-lock-object-la-gi.md","filePath":"blog/2024-01-18-thread-safe-va-lock-object-la-gi.md","lastUpdated":1748280138000}'),t={name:"blog/2024-01-18-thread-safe-va-lock-object-la-gi.md"},l=[a('<h1 id="thread-safe-lock-object-la-gi" tabindex="-1">Thread safe, Lock object lÃ  gÃ¬ ? <a class="header-anchor" href="#thread-safe-lock-object-la-gi" aria-label="Permalink to &quot;Thread safe, Lock object lÃ  gÃ¬ ?&quot;">â€‹</a></h1><p>Xin chÃ o má»i ngÆ°á»i,</p><p>HÃ´m nay, tÃ´i Ä‘Ã£ cÃ³ dá»‹p tham gia má»™t buá»•i Seminar thÃº vá»‹ cÃ¹ng anh Báº£o (<a href="https://www.facebook.com/bao.bao.bm" target="_blank" rel="noreferrer">Nguyá»…n Quá»‘c Báº£o</a>) - má»™t Ä‘á»“ng nghiá»‡p cÅ© tá»«ng sÃ¡t cÃ¡nh cÃ¹ng tÃ´i. Anh Báº£o Ä‘Ã£ dÃ nh thá»i gian Ä‘á»ƒ chia sáº» kiáº¿n thá»©c sÃ¢u sáº¯c vá» Concurrency vÃ  Thread, vÃ  tÃ´i pháº£i nÃ³i ráº±ng cÃ³ nhá»¯ng pháº§n trong bÃ i thuyáº¿t trÃ¬nh cá»§a anh áº¥y tháº­t sá»± lÃ  ráº¥t bá»• Ã­ch. <br> Nhá» cÃ³ buá»•i seminar nÃ y, tÃ´i Ä‘Ã£ hiá»ƒu rÃµ hÆ¡n nhiá»u vá» cÃ¡c khÃ¡i niá»‡m nÃ y vÃ  cÃ¡ch chÃºng tÃ¡c Ä‘á»™ng Ä‘áº¿n láº­p trÃ¬nh hiá»‡n Ä‘áº¡i.</p><p>Trong seminar, hai khÃ¡i niá»‡m Ä‘Æ°á»£c nháº¥n máº¡nh vá»›i má»©c Ä‘á»™ quan trá»ng cao lÃ  Thread safety vÃ  Object locks. <br> HÃ£y cÃ¹ng mÃ¬nh khÃ¡m phÃ¡, tÃ¬m hiá»ƒu vá» Thread safety vÃ  Object locks nhÃ©. <img src="https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img.png" alt="img"></p><nav class="table-of-contents"><ul><li><a href="#thread-safe-la-gi">Thread safe lÃ  gÃ¬ ?</a><ul><li><a href="#vi-du">VÃ­ dá»¥</a></li><li><a href="#code-demo-khong-thread-safety">code demo khÃ´ng Thread Safety</a></li></ul></li><li><a href="#lock-object-la-gi">Lock object lÃ  gÃ¬ ?</a></li><li><a href="#cac-han-che-cua-lock-object">CÃ¡c háº¡n cháº¿ cá»§a Lock object</a><ul><li><a href="#thoi-gian-cho-Ä‘oi-latency">Thá»i gian chá» Ä‘á»£i (Latency):</a></li><li><a href="#deadlocks">Deadlocks:</a></li><li><a href="#thu-tu-moi-priority-inversion">Thá»­ tá»± má»›i (Priority Inversion):</a></li><li><a href="#scalability">Scalability:</a></li></ul></li><li><a href="#cach-thuc-hoat-Ä‘ong-cua-lock-object-trong-java">CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a Lock object trong java</a><ul><li><a href="#set-of-threads-waiting-to-acquire-lock-tap-hop-cac-thread-cho-chiem-tai-nguyen">Set of threads waiting to acquire lock (Táº­p há»£p cÃ¡c thread chá» chiáº¿m tÃ i nguyÃªn)</a></li><li><a href="#acquire-chiem-lay">Acquire (Chiáº¿m láº¥y)</a></li><li><a href="#object">Object</a></li><li><a href="#monitor">Monitor</a></li><li><a href="#owning-thread">Owning thread</a></li><li><a href="#release-the-monitor-giai-phong-monitor">Release the monitor (Giáº£i phÃ³ng monitor)</a></li><li><a href="#set-of-waiting-threads-waiting-to-reacquire-lock-tap-hop-cac-thread-Ä‘ang-cho-Ä‘e-tai-chiem-lay-lock">Set of waiting threads waiting to reacquire lock (Táº­p há»£p cÃ¡c thread Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m láº¥y lock)</a></li></ul></li><li><a href="#vi-du-1">VÃ­ dá»¥:</a></li><li><a href="#vi-du-code">VÃ­ dá»¥ code:</a></li><li><a href="#tong-ket">Tá»•ng káº¿t</a></li></ul></nav><h2 id="thread-safe-la-gi" tabindex="-1">Thread safe lÃ  gÃ¬ ? <a class="header-anchor" href="#thread-safe-la-gi" aria-label="Permalink to &quot;Thread safe lÃ  gÃ¬ ?&quot;">â€‹</a></h2><p><strong>Thread Safe</strong> tháº­t sá»± lÃ  má»™t thuáº­t ngá»¯ gÃ¢y tÃ² mÃ², cÃ³ váº» nhÆ° nÃ³ Ä‘á» cáº­p Ä‘áº¿n má»™t thread khÃ´ng bá»‹ <strong>cháº¿t</strong>, váº­n hÃ nh nhanh chÃ³ng vÃ  á»•n Ä‘á»‹nh. ğŸ˜€ Tuy nhiÃªn, thá»±c táº¿ khÃ´ng pháº£i nhÆ° tháº¿.</p><p><strong>Thread Safe</strong> lÃ  má»™t khÃ¡i niá»‡m quan trá»ng trong láº­p trÃ¬nh mÃ¡y tÃ­nh, nháº¥t lÃ  trong bá»‘i cáº£nh mÃ  mÃ£ lá»‡nh Ä‘Æ°á»£c thá»±c thi Ä‘a luá»“ng (<strong>Multi-threaded</strong>).</p><p>Khi nÃ³i Ä‘áº¿n <strong>Thread Safe</strong>, ta Ä‘ang nÃ³i Ä‘áº¿n viá»‡c Ä‘áº£m báº£o ráº±ng cÃ¡c thao tÃ¡c truy cáº­p vÃ  sá»­a Ä‘á»•i dá»¯ liá»‡u <code>Ä‘Æ°á»£c chia sáº» giá»¯a cÃ¡c threads</code> diá»…n ra má»™t cÃ¡ch chÃ­nh xÃ¡c vÃ  an toÃ n, mÃ  khÃ´ng gáº·p pháº£i cÃ¡c tÃ¡c Ä‘á»™ng ngoÃ i Ã½ muá»‘n hay sá»± cáº¡nh tranh tiá»m áº©n giá»¯a chÃºng.</p><p>Trong cÆ¡ cháº¿ Thread Safe, cÃ¡c thao tÃ¡c nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ sao cho tuÃ¢n theo Ä‘Ãºng logic vÃ  cÃ¡c Ã½ Ä‘á»“ cá»§a ngÆ°á»i láº­p trÃ¬nh, Ä‘á» phÃ²ng hiá»‡n tÆ°á»£ng ghi chá»“ng lÃªn nhau hoáº·c Ä‘á»c dá»¯ liá»‡u sai lá»‡ch - nhá»¯ng sá»± kiá»‡n cÃ³ thá»ƒ khiáº¿n á»©ng dá»¥ng trá»Ÿ nÃªn khÃ´ng á»•n Ä‘á»‹nh hoáº·c tháº­m chÃ­ lÃ  há»ng hÃ³c.</p><h3 id="vi-du" tabindex="-1">VÃ­ dá»¥ <a class="header-anchor" href="#vi-du" aria-label="Permalink to &quot;VÃ­ dá»¥&quot;">â€‹</a></h3><p><img src="https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img2.png" alt="img"></p><p>áº¢nh trÃªn lÃ  má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh vá» váº¥n Ä‘á» khÃ´ng Thread Safe.</p><p>Trong trÆ°á»ng há»£p nÃ y, hai luá»“ng (Thread A vÃ  Thread B) cÃ¹ng cá»‘ gáº¯ng thá»±c hiá»‡n viá»‡c tÄƒng má»™t biáº¿n kiá»ƒu Integer.</p><p>Hai luá»“ng cÃ¹ng Ä‘á»c giÃ¡ trá»‹ hiá»‡n táº¡i lÃ  17 vÃ  Ä‘á»u tÃ­nh toÃ¡n giÃ¡ trá»‹ má»›i sáº½ lÃ  18. Máº·c dÃ¹ má»—i thread Ä‘á»u thá»ƒ hiá»‡n hÃ nh Ä‘á»™ng <strong>tÄƒng biáº¿n sá»‘</strong> riÃªng biá»‡t, do cÃ¹ng sá»­a Ä‘á»•i má»™t biáº¿n chung mÃ  khÃ´ng cÃ³ Ä‘á»“ng bá»™ hÃ³a (synchronization), káº¿t quáº£ cuá»‘i cÃ¹ng cá»§a biáº¿n chá»‰ tÄƒng lÃªn 1 Ä‘Æ¡n vá»‹, trá»Ÿ thÃ nh 18 thay vÃ¬ 19 nhÆ° mong Ä‘á»£i sau hai láº§n tÄƒng.</p><p>Äiá»u nÃ y dáº«n Ä‘áº¿n Race Condition, nghÄ©a lÃ  káº¿t quáº£ cá»§a viá»‡c thá»±c thi mÃ£ phá»¥ thuá»™c vÃ o thá»© tá»± hoáº·c thá»i gian mÃ  cÃ¡c threads truy cáº­p dá»¯ liá»‡u chia sáº».</p><p>Äá»ƒ giáº£i quyáº¿t sá»± cá»‘ nÃ y vÃ  <strong>Ä‘áº¡t Ä‘Æ°á»£c Thread Safety</strong>, cÃ¡c cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a nhÆ° locks, semaphores hoáº·c cÃ¡c cÆ¡ cháº¿ cao cáº¥p hÆ¡n nhÆ° atomic operations hoáº·c transactional memory cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng chá»‰ cÃ³ má»™t thread cÃ³ thá»ƒ sá»­a Ä‘á»•i biáº¿n táº¡i má»™t thá»i Ä‘iá»ƒm, tá»« Ä‘Ã³ Ä‘áº£m báº£o tÃ­nh chÃ­nh xÃ¡c vÃ  an toÃ n cá»§a cÃ¡c thao tÃ¡c.</p><h3 id="code-demo-khong-thread-safety" tabindex="-1">code demo khÃ´ng Thread Safety <a class="header-anchor" href="#code-demo-khong-thread-safety" aria-label="Permalink to &quot;code demo khÃ´ng Thread Safety&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.concurrent.CountDownLatch;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MainTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InterruptedException {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MainTest test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MainTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iMax </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CountDownLatch countDownLatch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iMax);</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iMax; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                test.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incrementCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                countDownLatch.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">countDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        countDownLatch.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(test.count);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> incrementCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Trong code demo á»Ÿ trÃªn, viá»‡c táº¡o 100.000 luá»“ng (Thread) vÃ  gá»i phÆ°Æ¡ng thá»©c <code>incrementCount</code> dá»± kiáº¿n sáº½ tÄƒng giÃ¡ trá»‹ cá»§a biáº¿n Ä‘áº¿m lÃªn 100.000. Tuy nhiÃªn, vÃ¬ code nÃ y khÃ´ng Ä‘áº£m báº£o Thread Safety, káº¿t quáº£ cÃ³ Ä‘Æ°á»£c sau má»—i láº§n cháº¡y khÃ´ng nháº¥t quÃ¡n, Ä‘Ã´i khi lÃ  chÃ­nh xÃ¡c 100.000 nhÆ°ng cÅ©ng cÃ³ thá»ƒ tháº¥p hÆ¡n, pháº£n Ã¡nh sá»± khÃ´ng Ä‘á»“ng bá»™ giá»¯a cÃ¡c luá»“ng khi cÃ¹ng sá»­a Ä‘á»•i biáº¿n chia sáº».</p><p>Náº¿u chÃºng ta láº§n lÆ°á»£t cháº¡y code nÃ y 5 láº§n, do sá»± khÃ´ng Ä‘á»“ng bá»™ mÃ  káº¿t quáº£ cÃ³ thá»ƒ sáº½ khÃ¡c nhau má»—i láº§n. ÄÃ¢y lÃ  má»™t biá»ƒu hiá»‡n rÃµ rÃ ng cá»§a hiá»‡n tÆ°á»£ng race condition, khiáº¿n cho láº­p trÃ¬nh viÃªn khÃ´ng thá»ƒ Ä‘oÃ¡n trÆ°á»›c Ä‘Æ°á»£c káº¿t quáº£ chÃ­nh xÃ¡c:</p><ol><li>Láº§n cháº¡y thá»© nháº¥t: 98,123</li><li>Láº§n cháº¡y thá»© hai: 99,431</li><li>Láº§n cháº¡y thá»© ba: 98,722</li><li>Láº§n cháº¡y thá»© tÆ°: 99,003</li><li>Láº§n cháº¡y thá»© nÄƒm: 100,000</li></ol><p>Má»—i láº§n cháº¡y cho ra má»™t káº¿t quáº£ khÃ¡c nhau, chá»§ yáº¿u tháº¥p hÆ¡n con sá»‘ mong Ä‘á»£i 100.000, bá»Ÿi vÃ¬ nhá»¯ng tÃ¡c Ä‘á»™ng Ä‘á»“ng thá»i khÃ´ng Ä‘Æ°á»£c Ä‘á»“ng bá»™ hÃ³a Ä‘Ãºng cÃ¡ch, dáº«n Ä‘áº¿n viá»‡c bá»‹ <strong>Ä‘Ã¨</strong> lÃªn giÃ¡ trá»‹ cá»§a cÃ¡c luá»“ng trÆ°á»›c Ä‘Ã³.</p><p>Äá»ƒ Ä‘áº£m báº£o Thread Safety, cÃ³ má»™t loáº¡t cÃ¡c cÆ¡ cháº¿ vÃ  phÆ°Æ¡ng phÃ¡p khÃ¡c nhau. Trong sá»‘ Ä‘Ã³, viá»‡c sá»­ dá»¥ng Lock Object lÃ  má»™t trong nhá»¯ng phÆ°Æ¡ng phÃ¡p phá»• biáº¿n nháº¥t.</p><h2 id="lock-object-la-gi" tabindex="-1">Lock object lÃ  gÃ¬ ? <a class="header-anchor" href="#lock-object-la-gi" aria-label="Permalink to &quot;Lock object lÃ  gÃ¬ ?&quot;">â€‹</a></h2><p>Lock Object hoáº¡t Ä‘á»™ng nhÆ° má»™t cÆ¡ cháº¿ báº£o vá»‡ hoáº·c chiáº¿m quyá»n truy cáº­p(Acquire the Lock), Ä‘áº£m báº£o ráº±ng má»™t tÃ i nguyÃªn Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi má»™t thread táº¡i má»™t thá»i Ä‘iá»ƒm, vÃ  ngÄƒn cháº·n cÃ¡c thread khÃ¡c truy cáº­p tÃ i nguyÃªn Ä‘Ã³ cho Ä‘áº¿n khi lock Ä‘Æ°á»£c giáº£i phÃ³ng quyá»n truy cáº­p(Release the Lock). <img src="https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img3.png" alt="img"></p><p>Äá»ƒ hiá»ƒu má»™t cÃ¡ch Ä‘Æ¡n giáº£n, hÃ£y tÆ°á»Ÿng tÆ°á»£ng Lock Object nhÆ° lÃ  má»™t chÃ¬a khÃ³a cho má»™t cÄƒn phÃ²ng chá»©a tÃ i nguyÃªn.</p><p>Chá»‰ má»™t ngÆ°á»i (thread) cáº§m chÃ¬a khÃ³a cÃ³ thá»ƒ vÃ o phÃ²ng vÃ  sá»­ dá»¥ng tÃ i nguyÃªn táº¡i má»™t thá»i Ä‘iá»ƒm. Khi há» rá»i phÃ²ng, há» sáº½ tráº£ láº¡i chÃ¬a khÃ³a Ä‘á»ƒ ngÆ°á»i tiáº¿p theo cÃ³ thá»ƒ vÃ o. Äiá»u nÃ y ngÄƒn cháº·n tÃ¬nh tráº¡ng <strong>cháº­t chá»™i</strong> trong phÃ²ng vÃ  Ä‘áº£m báº£o ráº±ng má»i ngÆ°á»i Ä‘á»u cÃ³ cÆ¡ há»™i sá»­ dá»¥ng tÃ i nguyÃªn má»™t cÃ¡ch cÃ³ tráº­t tá»± vÃ  an toÃ n.</p><p>Sá»­ dá»¥ng Lock Object lÃ  má»™t phÆ°Æ¡ng phÃ¡p Ä‘á»“ng bá»™ hÃ³a cho phÃ©p cÃ¡c threads luÃ´n cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u má»›i nháº¥t, vÃ¬ má»™t thread chá»‰ cÃ³ thá»ƒ truy cáº­p vÃ  thay Ä‘á»•i tÃ i nguyÃªn sau khi thread khÃ¡c Ä‘Ã£ hoÃ n táº¥t cÃ´ng viá»‡c cá»§a mÃ¬nh vÃ  giáº£i phÃ³ng quyá»n truy cáº­p.</p><p>Máº·c dÃ¹ phÆ°Æ¡ng phÃ¡p nÃ y Ä‘em láº¡i hiá»‡u quáº£ cao á»Ÿ khÃ­a cáº¡nh Ä‘á»“ng bá»™ hÃ³a vÃ  khÃ¡ dá»… triá»ƒn khai, nÃ³ cÅ©ng Ä‘i kÃ¨m vá»›i má»™t sá»‘ háº¡n cháº¿:</p><h2 id="cac-han-che-cua-lock-object" tabindex="-1">CÃ¡c háº¡n cháº¿ cá»§a Lock object <a class="header-anchor" href="#cac-han-che-cua-lock-object" aria-label="Permalink to &quot;CÃ¡c háº¡n cháº¿ cá»§a Lock object&quot;">â€‹</a></h2><h3 id="thoi-gian-cho-Ä‘oi-latency" tabindex="-1">Thá»i gian chá» Ä‘á»£i (Latency): <a class="header-anchor" href="#thoi-gian-cho-Ä‘oi-latency" aria-label="Permalink to &quot;Thá»i gian chá» Ä‘á»£i (Latency):&quot;">â€‹</a></h3><p>Náº¿u lock Ä‘Æ°á»£c giá»¯ trong thá»i gian dÃ i, cÃ¡c threads khÃ¡c pháº£i Ä‘á»£i cho Ä‘áº¿n khi lock Ä‘Æ°á»£c giáº£i phÃ³ng, Ä‘iá»u nÃ y cÃ³ thá»ƒ táº¡o ra Ä‘á»™ trá»… (latency) vÃ  giáº£m hiá»‡u suáº¥t á»©ng dá»¥ng.</p><h3 id="deadlocks" tabindex="-1">Deadlocks: <a class="header-anchor" href="#deadlocks" aria-label="Permalink to &quot;Deadlocks:&quot;">â€‹</a></h3><p>Khi hai hoáº·c nhiá»u threads Ä‘á»£i láº«n nhau giáº£i phÃ³ng lock mÃ  má»—i thread Ä‘ang giá»¯, khÃ´ng cÃ³ tiáº¿n trÃ¬nh nÃ o cÃ³ thá»ƒ tiáº¿p tá»¥c, vÃ  há»‡ thá»‘ng rÆ¡i vÃ o tráº¡ng thÃ¡i báº¿ táº¯c, tá»©c lÃ  deadlock.</p><h3 id="thu-tu-moi-priority-inversion" tabindex="-1">Thá»­ tá»± má»›i (Priority Inversion): <a class="header-anchor" href="#thu-tu-moi-priority-inversion" aria-label="Permalink to &quot;Thá»­ tá»± má»›i (Priority Inversion):&quot;">â€‹</a></h3><p>Trong má»™t sá»‘ trÆ°á»ng há»£p, thread cÃ³ Ä‘á»™ Æ°u tiÃªn tháº¥p cÃ³ thá»ƒ giá»¯ lock trong khi thread cÃ³ Ä‘á»™ Æ°u tiÃªn cao hÆ¡n pháº£i chá» Ä‘á»£i, dáº«n Ä‘áº¿n hiá»‡n tÆ°á»£ng <strong>priority inversion.</strong></p><h3 id="scalability" tabindex="-1">Scalability: <a class="header-anchor" href="#scalability" aria-label="Permalink to &quot;Scalability:&quot;">â€‹</a></h3><p>Viá»‡c sá»­ dá»¥ng quÃ¡ nhiá»u locks cÃ³ thá»ƒ khiáº¿n chÆ°Æ¡ng trÃ¬nh khÃ³ scale hÆ¡n, Ä‘áº·c biá»‡t lÃ  trong cÃ¡c há»‡ thá»‘ng lá»›n vá»›i nhiá»u threads cÃ¹ng hoáº¡t Ä‘á»™ng, do viá»‡c quáº£n lÃ½ locks trá»Ÿ nÃªn phá»©c táº¡p.</p><h2 id="cach-thuc-hoat-Ä‘ong-cua-lock-object-trong-java" tabindex="-1">CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a Lock object trong java <a class="header-anchor" href="#cach-thuc-hoat-Ä‘ong-cua-lock-object-trong-java" aria-label="Permalink to &quot;CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a Lock object trong java&quot;">â€‹</a></h2><p><img src="https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img3.png" alt="img"></p><p>HÃ¬nh áº£nh phÃ­a trÃªn lÃ  mÃ¬nh há»a vá» Lock Object. á» áº£nh sáº½ cÃ³ 1 sá»‘ Keywork mÃ  báº¡n nÃªn lÆ°u Ã½.</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>- Set of threads waiting to acquire lock (Táº­p há»£p cÃ¡c thread chá» chiáº¿m tÃ i nguyÃªn)</span></span>\n<span class="line"><span>- Acquire</span></span>\n<span class="line"><span>- Object</span></span>\n<span class="line"><span>- Monitor</span></span>\n<span class="line"><span>- Owning thread</span></span>\n<span class="line"><span>- Release</span></span>\n<span class="line"><span>- Set of waiting threads waiting to reacquire lock (Táº­p há»£p cÃ¡c thread Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m láº¥y lock)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="set-of-threads-waiting-to-acquire-lock-tap-hop-cac-thread-cho-chiem-tai-nguyen" tabindex="-1">Set of threads waiting to acquire lock (Táº­p há»£p cÃ¡c thread chá» chiáº¿m tÃ i nguyÃªn) <a class="header-anchor" href="#set-of-threads-waiting-to-acquire-lock-tap-hop-cac-thread-cho-chiem-tai-nguyen" aria-label="Permalink to &quot;Set of threads waiting to acquire lock (Táº­p há»£p cÃ¡c thread chá» chiáº¿m tÃ i nguyÃªn)&quot;">â€‹</a></h3><p>ÄÃ¢y lÃ  táº­p há»£p cÃ¡c threads Ä‘ang Ä‘á»£i quyá»n truy cáº­p vÃ o tÃ i nguyÃªn vÃ  sáº½ chá» cho Ä‘áº¿n khi lock Ä‘Æ°á»£c giáº£i phÃ³ng bá»Ÿi thread hiá»‡n táº¡i Ä‘ang giá»¯ lock.</p><h3 id="acquire-chiem-lay" tabindex="-1">Acquire (Chiáº¿m láº¥y) <a class="header-anchor" href="#acquire-chiem-lay" aria-label="Permalink to &quot;Acquire (Chiáº¿m láº¥y)&quot;">â€‹</a></h3><p>ÄÃ¢y lÃ  hÃ nh Ä‘á»™ng mÃ  thread thá»±c hiá»‡n Ä‘á»ƒ giÃ nh Ä‘Æ°á»£c lock trÆ°á»›c khi nÃ³ cÃ³ thá»ƒ truy cáº­p an toÃ n vÃ o má»™t tÃ i nguyÃªn chia sáº».</p><p>Khi má»™t thread Ä‘áº¿n <strong>Monitor</strong> vÃ  yÃªu cáº§u truy cáº­p, náº¿u monitor khÃ´ng bá»‹ chiáº¿m giá»¯, thread cÃ³ thá»ƒ <strong>acquire</strong> (chiáº¿m láº¥y hoáº·c giÃ nh láº¥y) monitor Ä‘á»ƒ báº¯t Ä‘áº§u cÃ´ng viá»‡c trÃªn tÃ i nguyÃªn Ä‘Æ°á»£c báº£o vá»‡.</p><h3 id="object" tabindex="-1">Object <a class="header-anchor" href="#object" aria-label="Permalink to &quot;Object&quot;">â€‹</a></h3><p>Trong ngá»¯ cáº£nh nÃ y, <strong>Object</strong> Ä‘á» cáº­p Ä‘áº¿n tÃ i nguyÃªn hoáº·c dá»¯ liá»‡u mÃ  threads cá»‘ gáº¯ng chiáº¿m quyá»n truy cáº­p Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c.</p><h3 id="monitor" tabindex="-1">Monitor <a class="header-anchor" href="#monitor" aria-label="Permalink to &quot;Monitor&quot;">â€‹</a></h3><p>Monitor trong láº­p trÃ¬nh Ä‘a luá»“ng lÃ  má»™t cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a cao cáº¥p giÃºp kiá»ƒm soÃ¡t viá»‡c truy cáº­p vÃ o má»™t Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c chia sáº» giá»¯a cÃ¡c threads khÃ¡c nhau. Má»—i monitor gáº¯n liá»n vá»›i má»™t Ä‘á»‘i tÆ°á»£ng vÃ  nÃ³ Ä‘áº£m nhiá»‡m viá»‡c Ä‘á»“ng bá»™ hÃ³a truy cáº­p Ä‘áº¿n Ä‘á»‘i tÆ°á»£ng Ä‘Ã³.</p><p>Monitor bao gá»“m hai thÃ nh pháº§n chÃ­nh:</p><ol><li><p><strong>CÃ¡c biáº¿n Ä‘iá»u kiá»‡n (Condition Variables)</strong>: Cho phÃ©p cÃ¡c threads Ä‘á»£i cho Ä‘áº¿n khi má»™t Ä‘iá»u kiá»‡n cá»¥ thá»ƒ Ä‘Æ°á»£c thá»a mÃ£n.</p></li><li><p><strong>Pháº§n thÃ¢n cá»§a Monitor (Monitor</strong>s Body)**: LÃ  Ä‘oáº¡n mÃ£ mÃ  chá»‰ cÃ³ má»™t thread Ä‘Æ°á»£c phÃ©p thá»±c thi táº¡i má»™t thá»i Ä‘iá»ƒm.</p></li></ol><p>Cá»¥ thá»ƒ hÆ¡n, khi má»™t thread muá»‘n truy cáº­p vÃ o tÃ i nguyÃªn Ä‘Æ°á»£c báº£o vá»‡ bá»Ÿi monitor, nÃ³ pháº£i trÆ°á»›c háº¿t <strong>acquire</strong> monitor cho Ä‘á»‘i tÆ°á»£ng Ä‘Ã³. Khi thread Ä‘Ã£ <strong>acquire</strong> monitor, nÃ³ trá»Ÿ thÃ nh <strong>owning thread</strong> vÃ  cÃ³ thá»ƒ thá»±c thi mÃ£ trong pháº§n thÃ¢n cá»§a monitor. Náº¿u trong khi má»™t thread Ä‘ang sá»Ÿ há»¯u monitor vÃ  má»™t thread khÃ¡c cÅ©ng cá»‘ gáº¯ng truy cáº­p tÃ i nguyÃªn nÃ y, thread Ä‘Ã³ sáº½ pháº£i Ä‘á»£i cho Ä‘áº¿n khi monitor Ä‘Æ°á»£c giáº£i phÃ³ng.</p><p>Viá»‡c sá»­ dá»¥ng monitor Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n cá»§a dá»¯ liá»‡u báº±ng cÃ¡ch ngÄƒn cháº·n cÃ¡c truy cáº­p Ä‘á»“ng thá»i, giÃºp trÃ¡nh Ä‘Æ°á»£c race condition vÃ  cÃ¡c váº¥n Ä‘á» Ä‘á»“ng bá»™ hÃ³a liÃªn quan Ä‘áº¿n viá»‡c quáº£n lÃ½ truy cáº­p vÃ o tÃ i nguyÃªn chia sáº». Monitor cung cáº¥p má»™t phÆ°Æ¡ng thá»©c Ä‘á»“ng bá»™ hÃ³a cÃ³ cáº¥u trÃºc rÃµ rÃ ng, thÆ°á»ng Ä‘Æ°á»£c Æ°a chuá»™ng vÃ¬ tÃ­nh an toÃ n vÃ  dá»… dÃ ng sá»­ dá»¥ng cá»§a nÃ³ trong quÃ¡ trÃ¬nh thiáº¿t káº¿ vÃ  triá»ƒn khai cÃ¡c pháº§n má»m phá»©c táº¡p dá»±a trÃªn mÃ´ hÃ¬nh Ä‘a luá»“ng.</p><h3 id="owning-thread" tabindex="-1">Owning thread <a class="header-anchor" href="#owning-thread" aria-label="Permalink to &quot;Owning thread&quot;">â€‹</a></h3><p>Khi má»™t thread Ä‘Ã£ <strong>acquire the monitor</strong> thÃ nh cÃ´ng, nÃ³ trá»Ÿ thÃ nh <strong>owning thread (thread sá»Ÿ há»¯u)</strong> vÃ  cÃ³ quyá»n kiá»ƒm soÃ¡t tÃ i nguyÃªn Ä‘Ã³ cho Ä‘áº¿n khi nÃ³ hoÃ n thÃ nh. Trong khoáº£ng thá»i gian nÃ y, khÃ´ng cÃ³ thread khÃ¡c cÃ³ thá»ƒ <strong>acquire monitor</strong> vÃ  truy cáº­p vÃ o tÃ i nguyÃªn Ä‘Ã³.</p><h3 id="release-the-monitor-giai-phong-monitor" tabindex="-1">Release the monitor (Giáº£i phÃ³ng monitor) <a class="header-anchor" href="#release-the-monitor-giai-phong-monitor" aria-label="Permalink to &quot;Release the monitor (Giáº£i phÃ³ng monitor)&quot;">â€‹</a></h3><p>Khi thread sá»Ÿ há»¯u hoÃ n thÃ nh cÃ¡c thao tÃ¡c cáº§n thiáº¿t cá»§a nÃ³ vá»›i tÃ i nguyÃªn, nÃ³ sáº½ <strong>release (giáº£i phÃ³ng)</strong> monitor. Viá»‡c nÃ y cho phÃ©p cÃ¡c thread khÃ¡c cÃ³ cÆ¡ há»™i Ä‘á»ƒ <strong>acquire monitor</strong> vÃ  báº¯t Ä‘áº§u sá»­ dá»¥ng tÃ i nguyÃªn.</p><h3 id="set-of-waiting-threads-waiting-to-reacquire-lock-tap-hop-cac-thread-Ä‘ang-cho-Ä‘e-tai-chiem-lay-lock" tabindex="-1">Set of waiting threads waiting to reacquire lock (Táº­p há»£p cÃ¡c thread Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m láº¥y lock) <a class="header-anchor" href="#set-of-waiting-threads-waiting-to-reacquire-lock-tap-hop-cac-thread-Ä‘ang-cho-Ä‘e-tai-chiem-lay-lock" aria-label="Permalink to &quot;Set of waiting threads waiting to reacquire lock (Táº­p há»£p cÃ¡c thread Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m láº¥y lock)&quot;">â€‹</a></h3><p>NÃ³ thÆ°á»ng Ä‘á» cáº­p Ä‘áº¿n má»™t nhÃ³m threads Ä‘Ã£ tá»«ng sá»Ÿ há»¯u lock trÆ°á»›c Ä‘Ã³ vÃ  bÃ¢y giá» Ä‘ang chá» Ä‘á»£i cÆ¡ há»™i Ä‘á»ƒ cáº¯t láº¥y lock trá»Ÿ láº¡i sau khi nÃ³ Ä‘Æ°á»£c giáº£i phÃ³ng bá»Ÿi thread hiá»‡n táº¡i. CÃ¡c threads trong táº­p há»£p nÃ y cÃ³ thá»ƒ Ä‘Ã£ pháº£i giáº£i phÃ³ng lock táº¡m thá»i do má»™t lÃ½ do nÃ o Ä‘Ã³, nhÆ° lÃ  sá»± chá» Ä‘á»£i cá»§a má»™t condition variable hoáº·c do má»™t há»‡ thá»‘ng láº­p lá»‹ch Ä‘a luá»“ng. Khi Ä‘iá»u kiá»‡n cho phÃ©p, chÃºng sáº½ cá»‘ gáº¯ng tÃ¡i chiáº¿m lock Ä‘á»ƒ tiáº¿p tá»¥c cÃ´ng viá»‡c cá»§a mÃ¬nh.</p><h2 id="vi-du-1" tabindex="-1">VÃ­ dá»¥: <a class="header-anchor" href="#vi-du-1" aria-label="Permalink to &quot;VÃ­ dá»¥:&quot;">â€‹</a></h2><p>Giáº£ sá»­ cÃ³ má»™t tÃ i nguyÃªn chia sáº» (nhÆ° má»™t object cá»¥ thá»ƒ trong mÃ£ láº­p trÃ¬nh) nÆ¡i má»™t thread (gá»i lÃ  Thread A) Ä‘ang giá»¯ lock vÃ  thá»±c hiá»‡n má»™t sá»‘ thao tÃ¡c. Bá»Ÿi vÃ¬ Thread A nÃ y cáº§n truy cáº­p vÃ o má»™t tÃ i nguyÃªn khÃ¡c hoáº·c chá» má»™t sá»± kiá»‡n nÃ o Ä‘Ã³ xáº£y ra Ä‘á»ƒ nÃ³ cÃ³ thá»ƒ tiáº¿p tá»¥c thá»±c hiá»‡n (vÃ­ dá»¥: chá» má»™t response tá»« server), nÃ³ sáº½ táº¡m thá»i release lock vÃ  Ä‘áº·t mÃ¬nh vÃ o tráº¡ng thÃ¡i <strong>waiting.</strong></p><p>Trong khi Ä‘Ã³, cÃ¡c threads khÃ¡c (Thread B, Thread C, v.v.) Ä‘ang chá» Ä‘á»£i cÆ¡ há»™i Ä‘á»ƒ <strong>acquire</strong> lock Ä‘Ã³ vÃ  sá»­ dá»¥ng tÃ i nguyÃªn chia sáº». Tuy nhiÃªn, vÃ¬ Thread A váº«n cáº§n hoÃ n thÃ nh cÃ´ng viá»‡c cá»§a mÃ¬nh vÃ  sáº½ cáº§n <strong>reacquire</strong> lock sau khi Ä‘iá»u kiá»‡n cho phÃ©p, nÃªn nÃ³ khÃ´ng thá»±c sá»± thoÃ¡t khá»i hÃ ng Ä‘á»£i mÃ  thay vÃ o Ä‘Ã³, nÃ³ váº«n lÃ  má»™t pháº§n cá»§a <strong>set of waiting threads</strong> Ä‘ang chá» Ä‘á»ƒ tÃ¡i chiáº¿m lock má»™t khi nÃ³ cÃ³ thá»ƒ tiáº¿p tá»¥c cÃ´ng viá»‡c.</p><p>Khi Ä‘iá»u kiá»‡n Ä‘Æ°á»£c thá»a mÃ£n cháº³ng háº¡n nhÆ° response tá»« server Ä‘Æ°á»£c nháº­n Thread A sáº½ cá»‘ gáº¯ng <strong>reacquire</strong> lock. Náº¿u nÃ³ thÃ nh cÃ´ng, nÃ³ cÃ³ thá»ƒ tiáº¿p tá»¥c cÃ´ng viá»‡c mÃ  khÃ´ng lÃ m máº¥t tiáº¿n trÃ¬nh. Trong trÆ°á»ng há»£p nÃ y, <strong>set of waiting threads waiting to reacquire lock</strong> chÃ­nh lÃ  cÃ¡c threads Ä‘Ã£ tá»«ng giá»¯ lock vÃ  cáº§n pháº£i tÃ¡i chiáº¿m lock Ä‘á»ƒ hoÃ n thÃ nh cÃ´ng viá»‡c cá»§a mÃ¬nh</p><h2 id="vi-du-code" tabindex="-1">VÃ­ dá»¥ code: <a class="header-anchor" href="#vi-du-code" aria-label="Permalink to &quot;VÃ­ dá»¥ code:&quot;">â€‹</a></h2><p>Java cung cáº¥p tá»« khÃ³a synchronized Ä‘á»ƒ giÃºp thá»±c hiá»‡n viá»‡c Ä‘á»“ng bá»™ hÃ³a:</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lock) {</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // MÃ£ Ä‘Æ°á»£c báº£o vá»‡ bá»Ÿi lock</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Khi má»™t thread bÆ°á»›c vÃ o khá»‘i synchronized, nÃ³ chiáº¿m lock vÃ  cÃ¡c thread khÃ¡c pháº£i Ä‘á»£i cho Ä‘áº¿n khi thread hiá»‡n táº¡i tráº£ láº¡i lock. Äiá»u nÃ y ngÄƒn cháº·n sá»± xung Ä‘á»™t giá»¯a cÃ¡c threads khi sá»­ dá»¥ng tÃ i nguyÃªn chung.</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Counter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> increment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lock) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Giáº£ sá»­ cÃ³ má»™t Ä‘iá»u kiá»‡n khiáº¿n thread nÃ y pháº£i chá»</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; releasing lock temporarily.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                lock.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wait</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (InterruptedException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> incrementByOtherThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lock) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; incremented count.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ThÃ´ng bÃ¡o cho thread khÃ¡c ráº±ng nÃ³ cÃ³ thá»ƒ tiáº¿p tá»¥c</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            lock.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">notify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> printCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count is: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThreadExample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Counter counter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Counter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Thread thread1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                counter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">increment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Thread 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Thread thread2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // Chá» má»™t chÃºt Ä‘á»ƒ Ä‘áº£m báº£o thread1 báº¯t Ä‘áº§u trÆ°á»›c.</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (InterruptedException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                counter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incrementByOtherThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Thread 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread2.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            thread1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            thread2.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (InterruptedException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        counter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dá»± kiáº¿n lÃ  2 náº¿u khÃ´ng cÃ³ xung Ä‘á»™t dá»¯ liá»‡u.</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>á» trÃªn lÃ  má»™t vÃ­ dá»¥ vá» Java mÃ´ phá»ng tÃ¬nh huá»‘ng mÃ  trong khi má»™t thread Ä‘ang chá» Ä‘á»£i má»™t lock, má»™t thread khÃ¡c chiáº¿m láº¥y lock Ä‘Ã³ vÃ  cÃ³ thá»ƒ thay Ä‘á»•i dá»¯ liá»‡u. ChÃºng ta sáº½ sá»­ dá»¥ng má»™t biáº¿n Ä‘áº¿m lÃ m tÃ i nguyÃªn chia sáº» vÃ  sáº½ triá»ƒn khai lock thÃ´ng qua hÃ m synchronized.</p><p>Trong vÃ­ dá»¥ nÃ y, thread1 báº¯t Ä‘áº§u thá»±c thi vÃ  gá»i phÆ°Æ¡ng thá»©c increment, Ä‘á»“ng thá»i cÃ³ pháº§n code chiáº¿m lock vÃ  sau Ä‘Ã³ táº¡m thá»i wait khiáº¿n cho thread giáº£i phÃ³ng lock nhÆ°ng váº«n á»Ÿ tráº¡ng thÃ¡i chá» Ä‘á»ƒ thá»±c thi tiáº¿p. Trong lÃºc Ä‘Ã³, thread2 cÃ³ cÆ¡ há»™i báº¯t Ä‘áº§u vÃ  chiáº¿m láº¥y lock báº±ng cÃ¡ch gá»i phÆ°Æ¡ng thá»©c incrementByOtherThread Ä‘á»ƒ tÄƒng biáº¿n count, sau Ä‘Ã³ nÃ³ gá»i notify Ä‘á»ƒ thÃ´ng bÃ¡o cho cÃ¡c thread Ä‘ang chá» lock cÃ³ thá»ƒ tiáº¿p tá»¥c.</p><p>Khi thread1 nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o nÃ y (sau khi thread2 giáº£i phÃ³ng lock), nÃ³ cÃ³ thá»ƒ tiáº¿p tá»¥c viá»‡c thá»±c thi. GiÃ¡ trá»‹ cuá»‘i cÃ¹ng cá»§a count phá»¥ thuá»™c vÃ o viá»‡c Ä‘Æ°á»ng dáº«n cá»§a mÃ£ cÃ³ xá»­ lÃ½ Ä‘Ãºng cÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i hay khÃ´ng. NhÆ° Ä‘Ã£ Ä‘á» cáº­p trong vÃ­ dá»¥, náº¿u khÃ´ng cÃ³ xung Ä‘á»™t dá»¯ liá»‡u, káº¿t quáº£ dá»± kiáº¿n sáº½ lÃ  2, bá»Ÿi vÃ¬ má»—i thread Ä‘á»u tÄƒng count má»™t láº§n.</p><p><img src="https://static-cdn.thanhlv.com/blog/images/2024-01-18-thread-safe-va-lock-object-la-gi/img4.png" alt="img"></p><p>Khi <strong>Set of waiting threads waiting to reacquire lock</strong> khÃ´ng bao giá» Acquire thÃ¬ má»™t Dealock sáº½ xáº£y ra, nÃ³ sáº½ chá» mÃ£i mÃ£i.</p><h2 id="tong-ket" tabindex="-1">Tá»•ng káº¿t <a class="header-anchor" href="#tong-ket" aria-label="Permalink to &quot;Tá»•ng káº¿t&quot;">â€‹</a></h2><p>Thread safety vÃ  lock objects lÃ  cÃ¡c thÃ nh pháº§n quan trá»ng cá»§a láº­p trÃ¬nh Ä‘a luá»“ng vÃ  giÃºp cÃ¡c á»©ng dá»¥ng hoáº¡t Ä‘á»™ng má»™t cÃ¡ch á»•n Ä‘á»‹nh vÃ  an toÃ n hÆ¡n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.</p><ol><li><p>Thread safe, Lock object lÃ  gÃ¬? Thread safety vÃ  object locks lÃ  hai khÃ¡i niá»‡m quan trá»ng trong láº­p trÃ¬nh Ä‘a luá»“ng. Thread safety Ä‘áº£m báº£o ráº±ng má»™t Ä‘oáº¡n mÃ£ cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi an toÃ n bá»Ÿi nhiá»u threads mÃ  khÃ´ng gÃ¢y ra xung Ä‘á»™t, trong khi object locks lÃ  má»™t cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a nháº±m kiá»ƒm soÃ¡t viá»‡c truy cáº­p vÃ o cÃ¡c tÃ i nguyÃªn chia sáº».</p></li><li><p>Thread safe lÃ  gÃ¬? Thread safe lÃ  kháº£ nÄƒng cá»§a má»™t Ä‘oáº¡n mÃ£ cho phÃ©p nhiá»u threads thá»±c thi mÃ  khÃ´ng áº£nh hÆ°á»Ÿng tá»›i mÃ´i trÆ°á»ng xung quanh má»™t cÃ¡ch khÃ´ng mong muá»‘n. Äiá»u nÃ y báº£o vá»‡ dá»¯ liá»‡u khá»i bá»‹ sá»­a Ä‘á»•i má»™t cÃ¡ch khÃ´ng an toÃ n, giáº£m thiá»ƒu cÃ¡c hiá»‡n tÆ°á»£ng nhÆ° race conditions vÃ  deadlocks.</p></li><li><p>Lock object lÃ  gÃ¬? Lock object lÃ  má»™t phÆ°Æ¡ng tiá»‡n Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng chá»‰ má»™t thread cÃ³ thá»ƒ truy cáº­p vÃ o má»™t tÃ i nguyÃªn cá»¥ thá»ƒ táº¡i má»™t thá»i Ä‘iá»ƒm. Khi má»™t thread muá»‘n sá»­ dá»¥ng tÃ i nguyÃªn, nÃ³ pháº£i <strong>Ä‘Æ°á»£c cáº¥p quyá»n</strong> (acquire) truy cáº­p báº±ng viá»‡c <strong>Ä‘áº¡t Ä‘Æ°á»£c</strong> (obtain) má»™t lock. Má»™t khi thread hoÃ n táº¥t viá»‡c sá»­ dá»¥ng tÃ i nguyÃªn, nÃ³ <strong>pháº£i tráº£ láº¡i quyá»n</strong> (release) lock Ä‘á»ƒ cÃ¡c thread khÃ¡c cÃ³ thá»ƒ sá»­ dá»¥ng tÃ i nguyÃªn Ä‘Ã³.</p></li><li><p>Háº¡n cháº¿ cá»§a Lock object CÃ¡c háº¡n cháº¿ bao gá»“m viá»‡c gÃ¢y ra thá»i gian chá» Ä‘á»£i (latency), nguy cÆ¡ xáº£y ra deadlocks vÃ  priority inversions, cÅ©ng nhÆ° váº¥n Ä‘á» vá» scalability, Ä‘áº·c biá»‡t lÃ  trong cÃ¡c há»‡ thá»‘ng lá»›n cÃ³ nhiá»u threads hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i.</p></li><li><p>CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng Lock object hoáº¡t Ä‘á»™ng theo cÆ¡ cháº¿ monitor, cho phÃ©p cÃ¡c threads láº¥y vÃ  tráº£ lock, vÃ  cÃ¡c threads khÃ¡c pháº£i Ä‘á»£i cho Ä‘áº¿n khi lock Ä‘Æ°á»£c tráº£ láº¡i trÆ°á»›c khi cÃ³ thá»ƒ tiáº¿p tá»¥c thá»±c thi.</p></li></ol>',79)];const e=i(t,[["render",function(i,a,h,t,e,c){return s(),n("div",null,l)}]]);export{h as __pageData,e as default};
